# YochuDetector2

## 概要
本アプリは時間的に連続する複数枚のキイロショウジョウバエの幼虫の画像からその行動を解析するMacOSアプリです。
以下の時間を検出することができます。

- 3令幼虫のワンダリング行動のスタート時間
- ワンダリング行動の終了時間

これらの検出内容はcsvファイルとして出力されます。
また、以下のように検出した幼虫の位置を矩形で示します。

| 検出前 | 検出後 |
|-|-|
|<img src="https://user-images.githubusercontent.com/47075496/170980754-45e0c507-06be-4079-8e28-577f2985f4cf.JPG" width="500">|<img src="https://user-images.githubusercontent.com/47075496/170980575-a7fd4987-e640-4e4f-81ee-d22ef9a76f03.JPG" width="500">|

## アプリ仕様
MacOS 11.3以上で動作します。
本アプリは以下の画面から成り立っています。

1. 入出力ファイル選択画面
2. 解析範囲設定画面
3. 解析詳細設定画面
4. 解析完了画面

| 入出力ファイル選択画面 | 解析範囲設定画面(範囲指定前) | 解析範囲設定画面(範囲指定後) |
|-|-|-|
|<img width="300" src="https://user-images.githubusercontent.com/47075496/170986094-d20bd659-c3b3-45ea-a0c6-72cba4fde71f.png">|<img width="300" src="https://user-images.githubusercontent.com/47075496/170986556-802f11f8-4748-499e-b1eb-1739ab0e69f4.png">|<img width="300" src="https://user-images.githubusercontent.com/47075496/170986708-02af377f-3b68-482d-96df-ec87f2485d12.png">|

| 解析詳細設定画面 | 解析完了画面 |
|-|-|
| <img width="300" src="https://user-images.githubusercontent.com/47075496/170986922-379d7a45-3146-4d68-98db-055316c1daf4.png"> |<img width="300" src="https://user-images.githubusercontent.com/47075496/170987121-80f23262-2e3b-42f8-aee5-b9fed3a6c9f7.png"> |


### 1. 入力ファイル選択画面
入出力するフォルダを選択する画面です。以下の操作を行うことができます。
- 入力する画像が入ったフォルダの選択
- 出力するcsvファイルと画像を保存するフォルダの選択
- 解析範囲設定画面への遷移

### 2. 解析範囲設定画面
入力画像で解析する範囲を設定する画面です。以下の操作を行うことができます。
- 解析範囲の設定
- 解析範囲内の試験管の数の設定
- 実験開始時間の設定
- 解析詳細設定への遷移
- 解析の開始

また解析では以下のことが行われます。
- 全ての画像に対して
  - 解析範囲のでの画像のトリミング
  - 餌領域と餌に接している幼虫を解析範囲からの除去
  - 幼虫の検出
  - 幼虫検出後の画像の保存
- 上記の操作が終わった後
  - ワンダリング行動の開始時間と終了時間の算出
  - csvファイルの出力

### 3. 解析詳細設定画面
解析で使用するハイパーパラメータを設定する画面です。以下のパラメータを設定することができます。
- 検出スコア
- 停止判定時間
- 停止判定座標誤差
- ワンダリング行動判定時間
- 撮影画像間隔
- 餌領域検出閾値

### 4. 解析完了画面
解析が完了した後に自動的に遷移する画面です。

## 開発
### 環境
Xcode: 13.3   
MacOS: 12.3

### インストール方法
1. リポジトリをクローン `git clone git@github.com:Etsuwo/YochuDetector.git`
2. Yolov5.mlmodelを取得して`プロジェクトルート/YochuDetector2/MLModel/`以下に配置する
3. プロジェクトファイルをを開いて実行する

### 設計・アーキテクチャ
UI: SwiftUI  
アーキテクチャ: MVVM  
非同期処理: Combine

